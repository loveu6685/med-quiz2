<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>é«˜è­¦è¨Šè—¥ç‰©è¨ºæ–·éŠæˆ²</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff;
            text-align: center;
            padding: 40px;
        }
        h1 {
            color: #2c3e50;
        }
        #nameSection, #gameSection, #resultSection {
            max-width: 600px;
            margin: 0 auto;
        }
        #nameSection input {
            width: 70%;
            padding: 10px;
            font-size: 16px;
            margin-right: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        #nameSection button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            border: none;
            background-color: #2c3e50;
            color: white;
        }
        #patient-symptom {
            font-size: 20px;
            margin-bottom: 20px;
            min-height: 100px;
            white-space: pre-wrap;
            text-align: left;
            background-color: #e9f0ff;
            padding: 15px;
            border-radius: 6px;
        }
        .med-btn {
            display: block;
            margin: 10px auto;
            padding: 10px 20px;
            font-size: 16px;
            width: 80%;
            max-width: 500px;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid #888;
            background-color: #e6f0ff;
            transition: background-color 0.3s;
            text-align: left;
        }
        .med-btn:hover:not(:disabled) {
            background-color: #c0d9ff;
        }
        .med-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        #answer-feedback {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            min-height: 60px;
            text-align: left;
            padding: 0 20px;
        }
        #next-btn {
            margin-top: 30px;
            padding: 10px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background-color: #2c3e50;
            color: white;
        }
        #next-btn:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        #progress {
            margin-top: 15px;
            color: #555;
            font-size: 16px;
        }
        #timer {
            font-size: 20px;
            color: red;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>ğŸ©º é«˜è­¦è¨Šè—¥ç‰©è¨ºæ–·éŠæˆ²</h1>

<div id="nameSection">
    <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" autocomplete="off" />
    <button id="startBtn">é–‹å§‹éŠæˆ²</button>
</div>

<div id="gameSection" style="display:none;">
    <div id="progress"></div>
    <div id="timer">â± 30ç§’</div>
    <div id="patient-symptom">è¼‰å…¥ä¸­...</div>
    <button class="med-btn" onclick="checkAnswer(0)">é¸é …1</button>
    <button class="med-btn" onclick="checkAnswer(1)">é¸é …2</button>
    <button class="med-btn" onclick="checkAnswer(2)">é¸é …3</button>
    <button class="med-btn" onclick="checkAnswer(3)">é¸é …4</button>
    <div id="answer-feedback"></div>
    <button id="next-btn" onclick="nextPatient()" disabled>ä¸‹ä¸€é¡Œ â¡</button>
</div>

<div id="resultSection" style="display:none; max-width:600px; margin:30px auto; text-align:left;">
</div>

 <!-- éŸ³æ•ˆ -->
    <!-- ç­”å°å®å’šè² -->
    <audio id="audioCorrect" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
    <!-- ç­”éŒ¯éŸ³æ•ˆ -->
    <audio id="audioWrong" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
    <!-- å€’æ•¸5ç§’è­¦å‘Š -->
    <audio id="audioWarning" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>


<script>
    // ä½ çš„é¡Œåº«ï¼ˆå·²æ”¹æˆä½ æä¾›çš„é¡Œç›®ï¼‰
    const questions = [
        {
            question: "1. Amiodarone çš„ä¸»è¦é©æ‡‰ç—‡æ˜¯ï¼Ÿ",
            options: ["A. å¿ƒæéç·©", "B. é«˜è¡€ç³–", " C. å¿ƒå¾‹ä¸æ•´", "D. é«˜è¡€é‰€"],
            correctAnswer: 2,
            explanation: "Amiodarone ä¸»è¦ç”¨æ–¼æ²»ç™‚å¿ƒå¾‹ä¸æ•´ã€‚"
        },
        {
            question: "2. ä½¿ç”¨ Atropine æ™‚æ‡‰æ³¨æ„å“ªå€‹å‰¯ä½œç”¨ï¼Ÿ",
            options: ["A. ä½è¡€å£“", " B. å¿ƒè·³éå¿«", "C. å™å¿ƒå˜”å", "D. è¡€ç³–å‡é«˜"],
            correctAnswer: 1,
            explanation: "Atropine å¸¸è¦‹å‰¯ä½œç”¨æ˜¯å¿ƒè·³éå¿«ã€‚"
        },
        {
            question: "3. Sodium bicarbonate çš„ä¸»è¦ç”¨é€”æ˜¯ï¼Ÿ",
            options: ["A. ä¿ƒé€²è¡€å£“ä¸Šå‡", " B. çŸ¯æ­£ä»£è¬æ€§é…¸ä¸­æ¯’", "C. å¢å¼·æ­¢ç—›ä½œç”¨", "D. é™ä½è¡€ç³–"],
            correctAnswer: 1,
            explanation: "Sodium bicarbonate ç”¨æ–¼çŸ¯æ­£ä»£è¬æ€§é…¸ä¸­æ¯’ã€‚"
        },
        {
            question: "4. Adenosine æŠ•èˆ‡æ™‚çš„æ³¨æ„äº‹é …ç‚ºï¼Ÿ",
            options: ["A. éœ€ç¨€é‡‹å¾Œç·©æ…¢æ»´æ³¨", "B. é©ç”¨æ–¼å¿ƒæéç·©æ‚£è€…", " C. éœ€å¿«é€Ÿéœè„ˆæ¨æ³¨ä¸¦ç«‹å³æ²–æ´—", "D. èˆ‡éˆ£åŠ‘åˆä½µä½¿ç”¨æ•ˆæœæ›´ä½³"],
            correctAnswer: 2,
            explanation: "Adenosine éœ€å¿«é€Ÿéœè„ˆæ¨æ³¨ä¸¦ç«‹å³æ²–æ´—ã€‚"
        },
        {
            question: "5. Norepinephrineè¦ç¨€é‡‹æ–¼å“ªç¨®é»æ»´?",
            options: ["A. N/S", "B. H/S", " C. D5W", "D. D10W"],
            correctAnswer: 2,
            explanation: "Norepinephrine éœ€ç¨€é‡‹æ–¼D5Wã€‚"
        },
        {
            question: "6. KCl éœ€ç‰¹åˆ¥æ³¨æ„ä¸‹åˆ—å“ªé»ï¼Ÿ",
            options: [" A. çµ•ä¸å¯éœè„ˆç›´æ¥æ¨æ³¨", "B. å¯ç¨€é‡‹å¾Œçš®ä¸‹æ³¨å°„", "C. ç©ºè…¹æœç”¨æ•ˆæœè¼ƒä½³", "D. èˆ‡è‘¡è„ç³–åˆä½µæ›´å®‰å…¨"],
            correctAnswer: 0,
            explanation: "KCl ä¸å¯éœè„ˆç›´æ¥æ¨æ³¨ï¼Œæ˜“è‡´æ­»ã€‚"
        },
        {
            question: "7. ä¸€ä½ç—…äººçªç™¼å¿ƒè·³åœæ­¢ï¼ŒCPR é€²è¡Œä¸­ï¼Œå·²è£ä¸Šå»é¡«å™¨ä½†å°šæœªæ¢å¾©å¿ƒè·³ã€‚è«‹å•æ­¤æ™‚è©²ç«‹å³æŠ•èˆ‡ï¼Ÿ",
            options: [" A. Epinephrine", "B. Amiodarone", "C. Midazolam", "D. Norepinephrine"],
            correctAnswer: 0,
            explanation: "å¿ƒè·³åœæ­¢æ™‚æ‡‰ç«‹å³æŠ•èˆ‡ Epinephrineã€‚"
        },
        {
            question: "8. ä¸€ä½ septic shock ç—…äººï¼ŒBP 78/45 mmHgã€HR 118 bpmï¼Œå°¿é‡ < 0.3 ml/kg/hrã€‚é†«å¸«é–‹ç«‹ Dopamine IVF æ»´æ³¨ã€‚è«‹å• Dopamine çš„åŠ‘é‡é¸æ“‡æœƒä¾è³´ä¸‹åˆ—å“ªå€‹ç›®çš„ï¼Ÿ",
            options: ["A. å°åŠ‘é‡ä¸»è¦å‡å£“ä½œç”¨", " B. ä¸­åŠ‘é‡ä¸»è¦å¢åŠ å¿ƒè¼¸å‡ºé‡èˆ‡è…çŒæµ", "C. é«˜åŠ‘é‡ä¿ƒé€²åˆ©å°¿", "D. ä»»æ„åŠ‘é‡çš†æœƒé€ æˆå¿ƒæéç·©"],
            correctAnswer: 1,
            explanation: "Dopamine ä¸­åŠ‘é‡ä¸»è¦å¢åŠ å¿ƒè¼¸å‡ºé‡èˆ‡è…çŒæµã€‚"
        },
        {
            question: "9. ä¸€ä½ä¸»è¨´èƒ¸æ‚¶ç–¼ç—›çš„ç—…äººè¢«è¨ºæ–·ç‚ºæ€¥æ€§å¿ƒçµç—›ï¼Œé†«å¸«ç«‹å³çµ¦äºˆ Nitroglycerin æ»´æ³¨ã€‚è­·ç†äººå“¡æ‡‰ç‰¹åˆ¥è§€å¯Ÿå“ªä¸€é …è®ŠåŒ–ï¼Ÿ",
            options: ["A. è‚åŠŸèƒ½é…µç´ æ˜¯å¦ä¸Šå‡", " B. è¡€å£“æ˜¯å¦éåº¦ä¸‹é™é€ æˆæšˆå¥", "C. é«”æº«æ˜¯å¦å‡é«˜", "D. æ˜¯å¦å‡ºç¾ä¾¿ç§˜"],
            correctAnswer: 1,
            explanation: "Nitroglycerin å¯èƒ½å°è‡´è¡€å£“éåº¦ä¸‹é™è€Œæšˆå¥ã€‚"
        },
        {
            question: "10. å“ªç¨®è—¥ç‰©å¿«é€Ÿä½¿ç”¨æœƒé€ æˆæ©‹è…¦é«“é˜æº¶è§£ï¼Ÿ",
            options: ["A. Tranexamic Acid", " B. 3% NaCl/500ML", "C. Magnesium Sulfate", "D. Norepinephrine"],
            correctAnswer: 1,
            explanation: "3% NaCl å¿«é€Ÿä½¿ç”¨å¯èƒ½é€ æˆæ©‹è…¦é«“é˜æº¶è§£ã€‚"
        }
    ];

    const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSeadu_EhQ83S2eZafsY2n1PKG9tynRsmB-kONYw_OyfdaNsWg/formResponse';
    const entryName = 'entry.1434240375';
    const entryScore = 'entry.335688250';

    let questionOrder = [];
    let currentIndex = 0;
    let score = 0;
    let timeLeft = 30;
    let timer;

    const playerNameInput = document.getElementById('playerName');
    const startBtn = document.getElementById('startBtn');
    const nameSection = document.getElementById('nameSection');
    const gameSection = document.getElementById('gameSection');
    const resultSection = document.getElementById('resultSection');

    const symptomDiv = document.getElementById('patient-symptom');
    const buttons = document.querySelectorAll('.med-btn');
    const feedbackDiv = document.getElementById('answer-feedback');
    const nextBtn = document.getElementById('next-btn');
    const progressDiv = document.getElementById('progress');
    const timerDiv = document.getElementById('timer');

    const audioCorrect = document.getElementById('audioCorrect');
    const audioWrong = document.getElementById('audioWrong');
    const audioCountdown = document.getElementById('audioCountdown');

    startBtn.addEventListener('click', () => {
        const name = playerNameInput.value.trim();
        if (!name) {
            alert("è«‹è¼¸å…¥å§“åæ‰èƒ½é–‹å§‹éŠæˆ²ï¼");
            return;
        }
        nameSection.style.display = 'none';
        gameSection.style.display = 'block';
        resetGame();
        shuffleQuestions();
        loadQuestion();
    });

    // æ´—ç‰Œå‡½å¼: Fisher-Yates æ´—ç‰Œæ³•
    function shuffleQuestions() {
        questionOrder = [...Array(questions.length).keys()];
        for (let i = questionOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [questionOrder[i], questionOrder[j]] = [questionOrder[j], questionOrder[i]];
        }
    }

    function resetGame() {
        currentIndex = 0;
        score = 0;
        timeLeft = 30;
        feedbackDiv.textContent = '';
        nextBtn.disabled = true;
        nextBtn.style.display = 'inline-block';
        resultSection.style.display = 'none';
    }

    function loadQuestion() {
        if (timer) clearInterval(timer);
        timeLeft = 30;
        timerDiv.textContent = `â± ${timeLeft}ç§’`;
        feedbackDiv.textContent = '';
        nextBtn.disabled = true;

        const q = questions[questionOrder[currentIndex]];
        symptomDiv.textContent = q.question;
        buttons.forEach((btn, i) => {
            btn.textContent = q.options[i];
            btn.disabled = false;
        });

        progressDiv.textContent = `é¡Œç›® ${currentIndex + 1} / ${questions.length}`;

        timer = setInterval(() => {
            timeLeft--;
            timerDiv.textContent = `â± ${timeLeft}ç§’`;

            if (timeLeft <= 5 && timeLeft > 0) {
                audioCountdown.play().catch(() => {});
            }

            if (timeLeft <= 0) {
                clearInterval(timer);
                checkAnswer(-1);
            }
        }, 1000);
    }

    function checkAnswer(selectedIndex) {
        if (timer) clearInterval(timer);
        const q = questions[questionOrder[currentIndex]];
        buttons.forEach(btn => btn.disabled = true);
        nextBtn.disabled = false;

        if (selectedIndex === q.correctAnswer) {
            score++;
            feedbackDiv.style.color = "green";
            feedbackDiv.textContent = " æ­£ç¢ºï¼" + q.explanation;
            audioCorrect.play().catch(() => {});
        } else if (selectedIndex === -1) {
            feedbackDiv.style.color = "red";
            feedbackDiv.textContent = "âŒ è¶…éæ™‚é–“ï¼" + q.explanation;
            audioWrong.play().catch(() => {});
        } else {
            feedbackDiv.style.color = "red";
            feedbackDiv.textContent = "âŒ éŒ¯èª¤ï¼" + q.explanation;
            audioWrong.play().catch(() => {});
        }
    }

    function nextPatient() {
        currentIndex++;
        if (currentIndex >= questions.length) {
            showResults();
        } else {
            loadQuestion();
        }
    }

    function showResults() {
        gameSection.style.display = 'none';
        resultSection.style.display = 'block';

        let resultMessage = "";
        if (score >= 8) {
            resultMessage = "ğŸ‘ å¾ˆæ£’çš„æ€¥æ•‘çŸ¥è­˜ï¼";
        } else if (score >= 5) {
            resultMessage = "ğŸ‘Œ é‚„ä¸éŒ¯ï¼Œå†ç·´ç·´ï¼";
        } else {
            resultMessage = "ğŸ§ åŠ æ²¹ï¼Œå†è©¦ä¸€æ¬¡ï¼";
        }

        resultSection.innerHTML = `
            <h2>ğŸ‰ æ‰€æœ‰é¡Œç›®å®Œæˆï¼</h2>
            <p>å§“åï¼š<strong>${escapeHtml(playerNameInput.value.trim())}</strong></p>
            <p>ä½ ç¸½å…±ç­”å°äº† <strong>${score}</strong> é¡Œï¼</p>
            <p>${resultMessage}</p>
            <button onclick="restartGame()">é‡æ–°é–‹å§‹</button>
        `;

        sendScoreToGoogleForm(playerNameInput.value.trim(), score);
    }

    function restartGame() {
        playerNameInput.value = "";
        nameSection.style.display = 'block';
        gameSection.style.display = 'none';
        resultSection.style.display = 'none';
    }

    function sendScoreToGoogleForm(name, score) {
        const formData = new FormData();
        formData.append(entryName, name);
        formData.append(entryScore, score);

        fetch(formUrl, {
            method: 'POST',
            mode: 'no-cors',
            body: formData
        }).catch((e) => {
            console.warn("æˆç¸¾é€å‡ºå¯èƒ½å¤±æ•—ï¼Œä½†éŠæˆ²å¯ç¹¼çºŒã€‚", e);
        });
    }

    // é¿å…XSSè¼¸å…¥æ³¨å…¥æ”»æ“Š
    function escapeHtml(text) {
        return text.replace(/[&<>"']/g, function(m) {
            return {'&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'}[m];
        });
    }
</script>

</body>
</html>
